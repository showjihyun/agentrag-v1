{
  "name": "Parallel & Merge - Concurrent Execution Test",
  "description": "Test parallel execution of multiple branches and merging results",
  "category": "control-flow",
  "workflow": {
    "nodes": [
      {
        "id": "start_1",
        "type": "start",
        "position": { "x": 100, "y": 200 },
        "data": {
          "label": "Start"
        }
      },
      {
        "id": "parallel_1",
        "type": "parallel",
        "position": { "x": 300, "y": 200 },
        "data": {
          "label": "Split Tasks",
          "parameters": {
            "branches": 3
          }
        }
      },
      {
        "id": "task_1",
        "type": "tool",
        "position": { "x": 500, "y": 50 },
        "data": {
          "label": "Task 1: Calculate",
          "tool_id": "python_code",
          "parameters": {
            "code": "import time\ntime.sleep(0.5)\nreturn {'task': 1, 'result': input.get('value', 0) * 2}"
          }
        }
      },
      {
        "id": "task_2",
        "type": "tool",
        "position": { "x": 500, "y": 200 },
        "data": {
          "label": "Task 2: Transform",
          "tool_id": "python_code",
          "parameters": {
            "code": "import time\ntime.sleep(0.3)\nreturn {'task': 2, 'result': str(input.get('value', 0)).upper()}"
          }
        }
      },
      {
        "id": "task_3",
        "type": "tool",
        "position": { "x": 500, "y": 350 },
        "data": {
          "label": "Task 3: Validate",
          "tool_id": "python_code",
          "parameters": {
            "code": "import time\ntime.sleep(0.4)\nreturn {'task': 3, 'result': input.get('value', 0) > 0}"
          }
        }
      },
      {
        "id": "merge_1",
        "type": "merge",
        "position": { "x": 700, "y": 200 },
        "data": {
          "label": "Merge Results",
          "parameters": {
            "mode": "wait_all",
            "input_count": 3
          }
        }
      },
      {
        "id": "end_1",
        "type": "end",
        "position": { "x": 900, "y": 200 },
        "data": {
          "label": "End"
        }
      }
    ],
    "edges": [
      {
        "id": "e1",
        "source": "start_1",
        "target": "parallel_1"
      },
      {
        "id": "e2",
        "source": "parallel_1",
        "target": "task_1"
      },
      {
        "id": "e3",
        "source": "parallel_1",
        "target": "task_2"
      },
      {
        "id": "e4",
        "source": "parallel_1",
        "target": "task_3"
      },
      {
        "id": "e5",
        "source": "task_1",
        "target": "merge_1"
      },
      {
        "id": "e6",
        "source": "task_2",
        "target": "merge_1"
      },
      {
        "id": "e7",
        "source": "task_3",
        "target": "merge_1"
      },
      {
        "id": "e8",
        "source": "merge_1",
        "target": "end_1"
      }
    ]
  },
  "test_cases": [
    {
      "name": "Parallel execution with value 10",
      "input": {
        "value": 10
      },
      "expected_output": {
        "tasks_completed": 3,
        "all_results_present": true
      }
    }
  ],
  "assertions": [
    {
      "type": "response_time",
      "max_seconds": 2,
      "note": "Should be faster than sequential (0.5+0.3+0.4=1.2s)"
    },
    {
      "type": "all_branches_executed"
    },
    {
      "type": "merge_successful"
    },
    {
      "type": "no_errors"
    }
  ]
}
