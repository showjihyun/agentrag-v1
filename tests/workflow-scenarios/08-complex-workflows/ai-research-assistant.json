{
  "name": "Complex Workflow - AI Research Assistant",
  "description": "Multi-step workflow: Vector search â†’ AI analysis â†’ Condition â†’ Slack notification",
  "category": "complex-workflows",
  "workflow": {
    "nodes": [
      {
        "id": "start_1",
        "type": "start",
        "position": { "x": 100, "y": 300 },
        "data": {
          "label": "Start"
        }
      },
      {
        "id": "vector_1",
        "type": "tool",
        "position": { "x": 300, "y": 300 },
        "data": {
          "label": "Search Documents",
          "tool_id": "vector_search",
          "parameters": {
            "query": "{{input.question}}",
            "collection_name": "documents",
            "top_k": 3,
            "score_threshold": 0.75
          }
        }
      },
      {
        "id": "condition_1",
        "type": "condition",
        "position": { "x": 500, "y": 300 },
        "data": {
          "label": "Check Results",
          "parameters": {
            "condition": "len(input.get('results', [])) > 0"
          }
        }
      },
      {
        "id": "openai_1",
        "type": "tool",
        "position": { "x": 700, "y": 200 },
        "data": {
          "label": "AI Analysis",
          "tool_id": "openai_chat",
          "parameters": {
            "model": "gpt-4-turbo-preview",
            "system_message": "You are a research assistant. Analyze the provided documents and answer the question.",
            "prompt": "Question: {{input.question}}\n\nDocuments:\n{{input.results}}\n\nProvide a comprehensive answer based on the documents.",
            "temperature": 0.3,
            "max_tokens": 500
          }
        }
      },
      {
        "id": "python_no_results",
        "type": "tool",
        "position": { "x": 700, "y": 400 },
        "data": {
          "label": "No Results Message",
          "tool_id": "python_code",
          "parameters": {
            "code": "return {'answer': 'No relevant documents found for your question.', 'confidence': 0}"
          }
        }
      },
      {
        "id": "slack_1",
        "type": "tool",
        "position": { "x": 900, "y": 300 },
        "data": {
          "label": "Send to Slack",
          "tool_id": "slack",
          "parameters": {
            "action": "send_message",
            "channel": "#research",
            "message": "ðŸ“š *Research Query*: {{input.question}}\n\n*Answer*:\n{{input.answer}}\n\n_Confidence: {{input.confidence}}_",
            "bot_token": "${SLACK_BOT_TOKEN}"
          }
        }
      },
      {
        "id": "end_1",
        "type": "end",
        "position": { "x": 1100, "y": 300 },
        "data": {
          "label": "End"
        }
      }
    ],
    "edges": [
      {
        "id": "e1",
        "source": "start_1",
        "target": "vector_1"
      },
      {
        "id": "e2",
        "source": "vector_1",
        "target": "condition_1"
      },
      {
        "id": "e3",
        "source": "condition_1",
        "target": "openai_1",
        "sourceHandle": "true"
      },
      {
        "id": "e4",
        "source": "condition_1",
        "target": "python_no_results",
        "sourceHandle": "false"
      },
      {
        "id": "e5",
        "source": "openai_1",
        "target": "slack_1"
      },
      {
        "id": "e6",
        "source": "python_no_results",
        "target": "slack_1"
      },
      {
        "id": "e7",
        "source": "slack_1",
        "target": "end_1"
      }
    ]
  },
  "test_cases": [
    {
      "name": "Research question with results",
      "input": {
        "question": "What are the best practices for API design?"
      },
      "expected_output": {
        "answer_not_empty": true,
        "slack_sent": true
      }
    },
    {
      "name": "Research question with no results",
      "input": {
        "question": "Completely unrelated random topic xyz123"
      },
      "expected_output": {
        "answer": "No relevant documents found for your question.",
        "confidence": 0
      }
    }
  ],
  "assertions": [
    {
      "type": "response_time",
      "max_seconds": 15
    },
    {
      "type": "all_nodes_executed"
    },
    {
      "type": "correct_branch_taken"
    },
    {
      "type": "no_errors"
    }
  ]
}
